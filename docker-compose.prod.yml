version: '3.8'

# This file is for production. It uses pre-built images from GHCR.
services:
  redis:
    image: redis:7-alpine
    container_name: mpb-redis
    restart: unless-stopped
    ports:
      - "6379:6379"

  mpb-telegram-bot:
    # Replace ackrome with your GitHub username
    image: ghcr.io/ackrome/matplobbot-bot:latest
    restart: unless-stopped
    env_file: ./.env
    container_name: mpb-telegram-bot
    volumes:
      - bot_db_data:/app/db_data
      - bot_logs:/app/logs
      - matplobblib_lib:/usr/local/lib/python3.11/site-packages/matplobblib # Persist library updates
    depends_on:
      - redis

  mpb-fastapi-stats:
    # Replace ackrome with your GitHub username
    image: ghcr.io/ackrome/matplobbot-api:latest
    restart: unless-stopped
    env_file: ./.env
    container_name: mpb-fastapi-stats
    ports:
      - "9583:9583"
    volumes:
      - bot_db_data:/app/db_data
      - bot_logs:/app/logs
    depends_on:
      - mpb-telegram-bot

volumes:
  bot_db_data:
  bot_logs:
  matplobblib_lib: